#Radar chart creation and analysis#libraries usedlibrary(data.table) #load csv fast library(dplyr) #data manipulationlibrary(Amelia) #investigate missing valueslibrary(lubridate) #date conversionlibrary(reshape2) #data manipulationlibrary(radarchart) #javascript radar chartlibrary(grDevices) #col2rgb#load, convert to data.table, and change date column to date typestats_dt <- data.table(read.csv(file = "My Received Files/ProductWithFundTypeNov.csv", stringsAsFactors = FALSE))stats_dt$EFFECTIVE_DATE <- dmy(stats_dt$EFFECTIVE_DATE)#Subset the columns into the ones we wantcountry_dt <- stats_dt[, .(EFFECTIVE_DATE,FUND_ASSET_TYPE,COUNTRY,NET_SALE_USD)]#filter by month of october, group by country, summarise by asset classes#month of octobercountry_dt_lm <- country_dt[EFFECTIVE_DATE == "2016-10-31" , .(SUM_NET_SALE_USD = sum(NET_SALE_USD)), .(COUNTRY, FUND_ASSET_TYPE)]#cast it into asset class columnscountry_dt_lm <- dcast.data.table(country_dt_lm, COUNTRY~FUND_ASSET_TYPE, value.var = "SUM_NET_SALE_USD")#replace NAs with 0country_dt_lm[is.na(country_dt_lm)] <- 0#normalize function normalize <- function(x){  return((x - min(x)) / (max(x) - min(x)))}#normalized data tablecountry_dt_lm_norm <- cbind(Country = country_dt_lm$COUNTRY, round(as.data.table(lapply(country_dt_lm[ , .(Alternatives, Balanced, Bond, Cash, Equity)],normalize)), digits = 2))country_dt_lm_norm <-dcast.data.table(melt(country_dt_lm_norm, id.vars = "Country"), variable ~ Country)#radar chart plotting all countriesc <- col2rgb(c("green", "yellow", "salmon1", "Purple", "Blue"))chartJSRadar(country_dt_lm_norm, maxScale = 1, showToolTipLabel = TRUE, labelSize = 20, scaleStepWidth = 0.1, addDots = F, colMatrix = c)#Last 6 months Averagecountry_dt_6m <- country_dt[EFFECTIVE_DATE >= "2016-04-30" & EFFECTIVE_DATE <="2016-09-30", .(SUM_NET_SALE_USD = sum(NET_SALE_USD)/6), .(COUNTRY, FUND_ASSET_TYPE)]#Cast it into tablecountry_dt_6m <- dcast.data.table(country_dt_6m, COUNTRY~FUND_ASSET_TYPE, value.var = "SUM_NET_SALE_USD")#replace NAs with 0country_dt_6m[is.na(country_dt_6m)] <- 0#normalized data tablecountry_dt_6m_norm <- cbind(Country = country_dt_6m$COUNTRY, round(as.data.table(lapply(country_dt_6m[ , .(Alternatives, Balanced, Bond, Cash, Equity)],normalize)), digits = 2))country_dt_6m_norm <-dcast.data.table(melt(country_dt_6m_norm, id.vars = "Country"), variable ~ Country)#countries last month and last 6 monthscn <- data.table(Asset_Class = country_dt_lm_norm$variable, Last_Month = country_dt_lm_norm$China, Last_6_Months = country_dt_6m_norm$China)chartJSRadar(cn, maxScale = 1, showToolTipLabel = TRUE, scaleStepWidth = 0.1, addDots = F, colMatrix = col2rgb(c("darkgreen", "green")))kr <- data.table(Asset_Class = country_dt_lm_norm$variable, Last_Month = country_dt_lm_norm$Korea, Last_6_Months = country_dt_6m_norm$Korea)chartJSRadar(kr, maxScale = 1, showToolTipLabel = TRUE, scaleStepWidth = 0.1, addDots = F, colMatrix = col2rgb(c("salmon1", "orange")))hk <- data.table(Asset_Class = country_dt_lm_norm$variable, Last_Month = country_dt_lm_norm$`Hong Kong`, Last_6_Months = country_dt_6m_norm$`Hong Kong`)chartJSRadar(hk, maxScale = 1, showToolTipLabel = TRUE, scaleStepWidth = 0.1, addDots = F, colMatrix = col2rgb(c("yellowgreen", "yellow")))sg <- data.table(Asset_Class = country_dt_lm_norm$variable, Last_Month = country_dt_lm_norm$Singapore, Last_6_Months = country_dt_6m_norm$Singapore)chartJSRadar(sg, maxScale = 1, showToolTipLabel = TRUE, scaleStepWidth = 0.1, addDots = F, colMatrix = col2rgb(c("purple", "violet")))tw <- data.table(Asset_Class = country_dt_lm_norm$variable, Last_Month = country_dt_lm_norm$Taiwan, Last_6_Months = country_dt_6m_norm$Taiwan)chartJSRadar(tw, maxScale = 1, showToolTipLabel = TRUE, scaleStepWidth = 0.1, addDots = F, colMatrix = col2rgb(c("blue", "lightblue")))#table of changetable_lm <- dcast.data.table(melt(country_dt_lm, id.vars = "COUNTRY"), variable ~ COUNTRY)table_6m <- dcast.data.table(melt(country_dt_6m, id.vars = "COUNTRY"), variable ~ COUNTRY)colnames(table_6m) <- c("Asset_Class", "China_6m", "Hong Kong_6m", "Korea_6m", "Singapore_6m", "Taiwan_6m")table_c <- cbind(table_lm, table_6m[ , -1, with = FALSE])#change for countriesax <- list(title = "")cn_ct <- table_c[, .(variable, China = round(China), China_6m, Change = round(((China - China_6m) / China_6m), digits = 2))]cn_ct[is.na(cn_ct)] <- 0plot_ly(cn_ct, x = ~Change, y = ~variable, type = "bar", orientation = "h", marker = list(color = 'rgba(0, 100, 0, 0.8)')) %>% layout(yaxis = ax)hk_ct <- table_c[, .(variable, `Hong Kong` = round(`Hong Kong`), `Hong Kong_6m`, Change = round(((`Hong Kong` - `Hong Kong_6m`) / `Hong Kong_6m`), digits = 2))]hk_ct[is.na(hk_ct)] <- 0plot_ly(hk_ct, x = ~Change, y = ~variable, type = "bar", orientation = "h", marker = list(color = 'rgba(154, 205, 50, 0.8)'))  %>% layout(yaxis = ax)kr_ct <- table_c[, .(variable, Change = round(((Korea - Korea_6m) / Korea_6m), digits = 2))]kr_ct[is.na(kr_ct)] <- 0plot_ly(kr_ct, x = ~Change, y = ~variable, type = "bar", orientation = "h", marker = list(color = 'rgba(255, 140, 105, 0.8)')) %>% layout(yaxis = ax)sg_ct <- table_c[, .(variable, Change = round(((Singapore - Singapore_6m) / Singapore_6m), digits = 2))]sg_ct[is.na(sg_ct)] <- 0plot_ly(sg_ct, x = ~Change, y = ~variable, type = "bar", orientation = "h", marker = list(color = 'rgba(160, 32, 240, 0.8)')) %>% layout(yaxis = ax)tw_ct <- table_c[, .(variable, Change = round(((Taiwan - Taiwan_6m) / Taiwan_6m), digits = 2))]tw_ct[is.na(tw_ct)] <- 0plot_ly(tw_ct, x = ~Change, y = ~variable, type = "bar", orientation = "h", marker = list(color = 'rgba(0, 0, 255, 0.8)')) %>% layout(yaxis = ax)#to do list# plot 6 months average (done)# show for all countries (done)# show on same radar chart of Singapore last month and last 6 months (done)#show tables of raw and normalized (done)# plots next to each other? (done)# research on mfrow for side b side plots 
